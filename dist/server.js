(()=>{var e={462:(e,t,a)=>{"use strict";a.r(t);const r=require("express");var n=a.n(r);const l=require("fs");var c=a.n(l);const s=require("path");var o=a.n(s);const i=require("react");var u=a.n(i);const m=require("react-dom/server");var d=a.n(m);const E=require("react-router-dom/server"),p=require("redux"),_=require("react-router-dom"),h=require("@mui/material/Button");var C=a.n(h);const f=require("react-redux");var T,v,b,I,N;!function(e){e.CHANGE_CONSTRUCTOR_TYPE="CHANGE_CONSTRUCTOR_TYPE",e.SET_CONSTRUCTOR_PARAMS="SET_CONSTRUCTOR_PARAMS",e.ADD_TABLE="ADD_TABLE",e.UPDATE_TABLE="UPDATE_TABLE",e.DELETE_TABLE="DELETE_TABLE",e.SELECT_TABLE="SELECT_TABLE",e.DELETE_HALL="DELETE_HALL",e.ADD_HALL="ADD_HALL",e.RESET_CONSTRUCTOR="RESET_CONSTRUCTOR",e.SAVE_HALL_ID_IN_CONSTRUCTOR="SAVE_HALL_ID_IN_CONSTRUCTOR",e.ADD_PLACE_IN_TABLE="ADD_PLACE_IN_TABLE",e.DELETE_PLACE_FROM_TABLE="DELETE_PLACE_FROM_TABLE"}(T||(T={})),(N=v||(v={})).LOAD_HALLS_REQUEST="LOAD_HALLS_REQUEST",N.LOAD_HALLS_REQUEST_SUCCESS="LOAD_HALLS_REQUEST_SUCCESS",N.ADD_NEW_HALL_REQUEST="ADD_NEW_HALL_REQUEST",N.ADD_NEW_HALL_REQUEST_SUCCESS="ADD_NEW_HALL_REQUEST_SUCCESS",function(e){e.new="new",e.edit="edit"}(b||(b={})),function(e){e.free="FREE",e.reserved="RESERVED",e.notSetting="NOT SETTING"}(I||(I={}));var L=function(e){return{type:T.CHANGE_CONSTRUCTOR_TYPE,mode:e}},A=function(e){return{type:T.SET_CONSTRUCTOR_PARAMS,params:e}},S=function(e){return e.administration},P=function(e){return e.administration.halls},y=function(e,t){var a=e.administration.halls.findIndex((function(e){return e.hallId===t}));return e.administration.halls[a].tables},R=function(e){return e.administration.constructor},D=function(e){return e.administration.constructor.mode},x=function(e){return e.administration.constructor.constructorParameters};const z=function(e){var t=e.id,a=e.maxTablesCount,r=(0,_.useNavigate)(),n=(0,f.useDispatch)(),l=(0,f.useSelector)((function(e){return y(e,t)}));return u().createElement("div",{className:"hallContainer"},u().createElement("h2",{className:"hallContainer__headline"},"Зал ",t),u().createElement(C(),{className:"hallContainer__delBtn",variant:"outlined",sx:{color:"red",border:"1px solid red"},onClick:function(){return function(e){var t;n((t=e,{type:T.DELETE_HALL,hallId:t}))}(t)}},"Удалить"),u().createElement("ul",{className:"hallList"},l.map((function(e){return u().createElement("li",{key:e.tableId,className:"hallListItem",onClick:function(){return function(e,t){n(L(t.type)),n(function(e,t,a,r){return{type:T.SELECT_TABLE,hallId:e,tableId:t,constructorParameters:a,places:r}}(e,t.tableId,{placesCount:t.constructorParams.placesCount,sizeCircle:t.constructorParams.sizeCircle,sizeX:t.constructorParams.sizeX,sizeY:t.constructorParams.sizeY},t.places)),r("tableConstructor?type=edit")}(t,e)}},u().createElement("span",{className:"hallListItem__id"},"Стол №",e.tableId),u().createElement("span",{className:"hallListItem__countPlaces"},"Мест : ",e.places.length))})),l.length<a&&u().createElement("li",{className:"hallListItem"},u().createElement("button",{className:"hallContainer__addTableBtn",type:"button",onClick:function(){return e=t,n({type:T.RESET_CONSTRUCTOR}),n(function(e){return{type:T.SAVE_HALL_ID_IN_CONSTRUCTOR,hallId:e}}(e)),void r("tableConstructor?type=new");var e}},"Добавить стол"))))},O=require("tslib"),B=require("@mui/material/Box");var g=a.n(B);const k=function(e){var t=(0,f.useDispatch)(),a=e.placeStatus,r=e.tableType,n=e.placeId,l=e.hallId,c=e.tableId,s=function(e,t,r){switch(a){case I.free:m(e,t,r);break;case I.notSetting:o(r)}},o=function(e){var a,r={placeId:e,placeStatus:I.free};t((a=r,{type:T.ADD_PLACE_IN_TABLE,place:a}))},m=function(e,a,r){t(function(e,t,a){return{type:T.DELETE_PLACE_FROM_TABLE,hallId:e,tableId:t,placeId:a}}(e,a,r))},d=(0,i.useMemo)((function(){return"square"===r?"tableGeneralContainer__place tableGeneralContainer__place_square":"circle"===r?"tableGeneralContainer__place tableGeneralContainer__place_circle":void 0}),[r]);switch(a){case I.notSetting:return u().createElement("button",{className:d,type:"button",onClick:function(){return s(l,c,n)}},"Добавить ",u().createElement("br",null)," место");case I.reserved:return u().createElement("div",{className:"".concat(d," tableGeneralContainer__place_reserved")},"Забронировано");case I.free:return u().createElement("button",{className:d,type:"button",onClick:function(){return s(l,c,n)}},"Свободно");default:return null}},U=function(e){var t=e.type,a=e.countPlacesCircle,r=e.size,n=e.places,l=e.tableId,c=e.hallId,s=(0,O.__read)(r,2),o=s[0],i=s[1],m=360/a,d=Array.from(Array(a).keys()),E=0,p=Array.from(Array((o+2)*(i+2)).keys()),_=0,h=function(e,t){var a=0,r=a+e+1;return t.map((function(n){return n<e+1&&n>0||n>t.length-2-e&&n<t.length-1?n:0===a||a===t.length-e-2||n!==a&&n!==r?void(n===r&&(r=(a=n+1)+e+1)):n}))}(o,p);switch(t){case"square":return u().createElement("div",{style:{padding:0},className:"tableGeneralContainer"},u().createElement("div",{style:{gridTemplateColumns:"repeat(".concat(o+2,", 100px)"),gridTemplateRows:"repeat(".concat(i+2,", 100px)")},className:"squareTableContainer"},p.map((function(e){if(h.includes(e)){_++;var a=n.find((function(e){return e.placeId===_}));return u().createElement(k,{placeId:_,hallId:c,tableId:l,tableType:t,key:e,placeStatus:a?a.placeStatus:I.notSetting})}return u().createElement("div",{key:e})})),u().createElement(g(),{className:"squareTableContainer__table",sx:{width:"".concat(50+100*o+"","px"),height:"".concat(50+100*i+"","px"),backgroundColor:"primary.dark",border:"2px solid #000000"}})));case"circle":return u().createElement("div",{className:"tableGeneralContainer"},u().createElement("div",{className:"circleTableContainer"},d.map((function(e){0==e&&(E=0),E+=m;var a=n.find((function(t){return t.placeId===e+1}));return u().createElement("div",{key:e,style:{transform:"rotate(".concat(E+"","deg) translateX(-50%)"),transformOrigin:"1px ".concat(50+50*o+"","px")},className:"circleTablePlaceWrapper"},u().createElement(k,{placeId:e+1,hallId:c,tableId:l,tableType:t,placeStatus:a?a.placeStatus:I.notSetting}))})),u().createElement(g(),{className:"circleTableContainer__table",sx:{width:100*o,height:100*i,backgroundColor:"primary.dark",borderRadius:100,border:"2px solid #000000",position:"relative"}})));default:return}};var H;const W=function(){var e=(0,O.__read)((0,_.useSearchParams)(),1)[0],t=(0,_.useNavigate)(),a=(0,f.useDispatch)(),r=(0,f.useSelector)(D),n=(0,f.useSelector)(R),l=(0,f.useSelector)(x),c=(0,f.useSelector)((function(e){return y(e,n.hallId)})),s=0;switch(c&&(s=(0,i.useMemo)((function(){return function(e){var t=1,a=0;if(e.length){var r=e.map((function(e){return e.tableId}));return e.forEach((function(e,n){e.tableId>=a&&(a=e.tableId,a++),t=r.includes(n+1)?a:n+1})),t}return 1}(c)}),[c])),e.get("type")){case"new":H=b.new;break;case"edit":H=b.edit}var o=function(e){var t={placesCount:l.placesCount,sizeCircle:l.sizeCircle,sizeX:l.sizeX,sizeY:l.sizeY};switch(t[e]++,e){case"sizeCircle":t[e]<4&&a(A(t));break;case"sizeX":case"sizeY":t[e]<8&&a(A(t));break;case"placesCount":t[e]<21&&a(A(t));break;default:a(A(t))}},m=function(e){var t={placesCount:l.placesCount,sizeCircle:l.sizeCircle,sizeX:l.sizeX,sizeY:l.sizeY};t[e]--,t[e]>=1&&a(A(t))};return u().createElement("div",{className:"modalOverlay"},u().createElement("div",{className:"constructorContainer"},u().createElement("div",{className:"constructorContainerGeneral"},u().createElement("div",{className:"constructorContainerHeader"},u().createElement(C(),{className:"constructorContainerHeader__saveBtn",variant:"contained",onClick:function(){return function(e){switch(H){case"edit":var t={tableId:n.tableId,type:n.mode,maxPlaces:"square"===r?n.constructorParameters.sizeX+n.constructorParameters.sizeY:"circle"===r?n.constructorParameters.placesCount:0,places:n.places,constructorParams:{placesCount:n.constructorParameters.placesCount,sizeCircle:n.constructorParameters.sizeCircle,sizeX:n.constructorParameters.sizeX,sizeY:n.constructorParameters.sizeY}};a(function(e,t){return{type:T.UPDATE_TABLE,hallId:e,table:t}}(e,t));break;case"new":var l={tableId:s,type:n.mode,maxPlaces:"square"===r?n.constructorParameters.sizeX+n.constructorParameters.sizeY:"circle"===r?n.constructorParameters.placesCount:0,places:n.places,constructorParams:{placesCount:n.constructorParameters.placesCount,sizeCircle:n.constructorParameters.sizeCircle,sizeX:n.constructorParameters.sizeX,sizeY:n.constructorParameters.sizeY}};a(function(e,t){return{type:T.ADD_TABLE,hallId:e,table:t}}(e,l))}alert("Изменения сохранены")}(n.hallId)}},"Сохранить"),H===b.edit&&u().createElement(C(),{className:"constructorContainerHeader__delBtn",variant:"contained",onClick:function(){return e=n.hallId,r=n.tableId,a(function(e,t){return{type:T.DELETE_TABLE,hallId:e,tableId:t}}(e,r)),void t("/administration");var e,r}},"Удалить"),u().createElement("h2",{className:"constructorContainerHeader__headline"},"Конструктор")),u().createElement("div",{className:"contructorTableType"},u().createElement(C(),{className:"contructorTableType__squareBhtn",variant:"outlined",disabled:"square"===r,onClick:function(){a(L("square"))}},"Квадратный"),u().createElement(C(),{className:"contructorTableType__roundBtn",variant:"outlined",disabled:"circle"===r,onClick:function(){a(L("circle"))}},"Круглый")),"circle"===r&&u().createElement(u().Fragment,null,u().createElement("div",{className:"tableWrapper"},u().createElement(U,{hallId:n.hallId,tableId:H===b.edit?n.tableId:s,constructorMode:H,places:n.places,type:"circle",countPlacesCircle:l.placesCount,size:[l.sizeCircle,l.sizeCircle]}))),"square"===r&&u().createElement(u().Fragment,null,u().createElement("div",{className:"tableWrapper"},u().createElement(U,{hallId:n.hallId,tableId:H===b.edit?n.tableId:s,constructorMode:H,places:n.places,type:"square",countPlacesCircle:l.placesCount,size:[l.sizeX,l.sizeY]})))),u().createElement("div",{className:"controlPanel"},"square"===r&&u().createElement(u().Fragment,null,u().createElement("div",{className:"controlPanelElement"},u().createElement("div",{className:"controlPanelElementTextWrapper"},u().createElement("span",{className:"controlPanelElementTextWrapper__label"},"Размер по X"),u().createElement("span",{className:"controlPanelElementTextWrapper__value"},l.sizeX)),u().createElement("div",{className:"controlPanelElementBtnWrapper"},u().createElement(C(),{className:"controlPanelElementBtnWrapper__increaseBtn",variant:"contained",onClick:function(){return o("sizeX")}},"Увеличить"),u().createElement(C(),{className:"controlPanelElementBtnWrapper__decreaseBtn",variant:"contained",onClick:function(){return m("sizeX")}},"Уменьшить"))),u().createElement("div",{className:"controlPanelElement"},u().createElement("div",{className:"controlPanelElementTextWrapper"},u().createElement("span",{className:"controlPanelElementTextWrapper__label"},"Размер по Y"),u().createElement("span",{className:"controlPanelElementTextWrapper__value"},l.sizeY)),u().createElement("div",{className:"controlPanelElementBtnWrapper"},u().createElement(C(),{className:"controlPanelElementBtnWrapper__increaseBtn",variant:"contained",onClick:function(){return o("sizeY")}},"Увеличить"),u().createElement(C(),{className:"controlPanelElementBtnWrapper__decreaseBtn",variant:"contained",onClick:function(){return m("sizeY")}},"Уменьшить")))),"circle"===r&&u().createElement(u().Fragment,null,u().createElement("div",{className:"controlPanelElement"},u().createElement("div",{className:"controlPanelElementTextWrapper"},u().createElement("span",{className:"controlPanelElementTextWrapper__label"},"Размер"),u().createElement("span",{className:"controlPanelElementTextWrapper__value"},l.sizeCircle)),u().createElement("div",{className:"controlPanelElementBtnWrapper"},u().createElement(C(),{className:"controlPanelElementBtnWrapper__increaseBtn",variant:"contained",onClick:function(){return o("sizeCircle")}},"Увеличить"),u().createElement(C(),{className:"controlPanelElementBtnWrapper__decreaseBtn",variant:"contained",onClick:function(){return m("sizeCircle")}},"Уменьшить"))),u().createElement("div",{className:"controlPanelElement"},u().createElement("div",{className:"controlPanelElementTextWrapper"},u().createElement("span",{className:"controlPanelElementTextWrapper__label"},"Кол-во мест"),u().createElement("span",{className:"controlPanelElementTextWrapper__value"},l.placesCount)),u().createElement("div",{className:"controlPanelElementBtnWrapper"},u().createElement(C(),{className:"controlPanelElementBtnWrapper__increaseBtn",variant:"contained",onClick:function(){return o("placesCount")}},"Увеличить"),u().createElement(C(),{className:"controlPanelElementBtnWrapper__decreaseBtn",variant:"contained",onClick:function(){return m("placesCount")}},"Уменьшить"))))),u().createElement("button",{className:"constructorContainer__closeBtn",type:"button",onClick:function(){t("/administration")}})))};var q=function(){return{type:v.LOAD_HALLS_REQUEST}};const Y=function(){var e=(0,f.useDispatch)(),t=(0,f.useSelector)(S).halls;return u().useEffect((function(){e(q())}),[]),u().createElement(u().Fragment,null,u().createElement("header",{className:"headerSection"},u().createElement("div",{className:"fixed-container flex-container"},u().createElement("h2",{className:"headerSection__headline"},"Бронирование столов. Администрирование"),u().createElement("div",{className:"headerInfoContainer"},u().createElement("span",{className:"headerInfoContainer__username"},"Пользователь")))),u().createElement("main",{className:"mainSection"},u().createElement("div",{className:"fixed-container flex-container"},u().createElement("div",{className:"add"},u().createElement(C(),{className:"add__btn",variant:"outlined",sx:{border:"1px solid #e87b16",color:"#e87b16"},onClick:function(){var a,r=0;t.length?t.forEach((function(e){e.hallId>=r&&(r=e.hallId,r++)})):r=1,e((a={hallId:r,maxTablesCount:20,tables:[]},{type:T.ADD_HALL,hall:a}))}},"Добавить зал")),t.map((function(e){return u().createElement(z,{key:e.hallId,id:e.hallId,maxTablesCount:e.maxTablesCount})})))),u().createElement(_.Routes,null,u().createElement(_.Route,{path:"tableConstructor",element:u().createElement(W,null)})))},X=function(){var e=(0,f.useSelector)(P);return u().createElement("ul",{className:"reservehallList"},e.map((function(e){return u().createElement("li",{key:e.hallId,className:"reservehallListItem"},u().createElement(_.Link,{className:"reservehallListItemLink",to:"hall/".concat(e.hallId)},u().createElement("h3",{className:"reservehallListItemLink__headline"},"Залл №",e.hallId),u().createElement("span",{className:"reservehallListItemLink__countTables"},"Количество столов : ",e.tables.length," из ",e.maxTablesCount)))})))},w=function(){var e=(0,_.useParams)().id,t=(0,f.useSelector)((function(t){return y(t,Number(e))}));return u().createElement("div",{className:"reserveHall"},u().createElement(_.Link,{to:"/"},"Назад"),u().createElement("ul",{className:"reserveHallList"},t.map((function(e){return u().createElement("li",{key:e.tableId,className:"reserveHallListItem"},u().createElement(_.Link,{to:"table/".concat(e.tableId)},u().createElement("h3",{className:""},"Стол №",e.tableId),u().createElement("span",{className:""},"Свободно мест : 1 из ",e.places.length)))}))))},M=function(){var e=(0,f.useDispatch)();return u().useEffect((function(){e(q())}),[]),u().createElement(u().Fragment,null,u().createElement("header",{className:"headerSection"},u().createElement("div",{className:"fixed-container"},u().createElement("h2",{className:""},"Бронирование столов"))),u().createElement("main",null,u().createElement("div",{className:"fixed-container"},u().createElement("div",{className:"reserveContainer"},u().createElement(_.Link,{to:"/administration"},"Перейти в админинистрирование"),u().createElement(_.Routes,null,u().createElement(_.Route,{path:"/",element:u().createElement(X,null)}),u().createElement(_.Route,{path:"hall/:id",element:u().createElement(w,null)}))))))},G=function(){return u().createElement("div",{className:"appContainer"},u().createElement("h1",{className:"appContainer__headline visually-hidden"},"Сервис бронирование столов"),u().createElement(_.Routes,null,u().createElement(_.Route,{path:"/*",element:u().createElement(M,null)}),u().createElement(_.Route,{path:"administration/*",element:u().createElement(Y,null)})))};var F={mode:"circle",places:[],constructorParameters:{sizeCircle:2,placesCount:1,sizeX:1,sizeY:1},hallId:0,tableId:0},Q={constructor:F,halls:[]},j=(0,p.combineReducers)({administration:function(e,t){switch(void 0===e&&(e=Q),t.type){case T.ADD_TABLE:var a=e.halls.find((function(e){return e.hallId===t.hallId})),r=e.halls.indexOf(a),n=(0,O.__spreadArray)((0,O.__spreadArray)([],(0,O.__read)(e.halls[r].tables),!1),[t.table],!1),l=(0,O.__spreadArray)([],(0,O.__read)(e.halls),!1);return l[r].tables=n,{constructor:e.constructor,halls:l};case T.UPDATE_TABLE:var c=e.halls.find((function(e){return e.hallId===t.hallId})),s=e.halls.indexOf(c),o=(0,O.__spreadArray)([],(0,O.__read)(e.halls[s].tables),!1).map((function(e){return e.tableId===t.table.tableId?t.table:e}));return{halls:e.halls.map((function(e){return e.hallId===t.hallId?{hallId:e.hallId,maxTablesCount:e.maxTablesCount,tables:o}:e})),constructor:e.constructor};case T.DELETE_TABLE:var i=e.halls.find((function(e){return e.hallId===t.hallId})),u=e.halls.indexOf(i),m=e.halls[u].tables.find((function(e){return e.tableId===t.tableId})),d=(0,O.__spreadArray)([],(0,O.__read)(e.halls[u].tables),!1);d.splice(d.indexOf(m),1);var E=(0,O.__spreadArray)([],(0,O.__read)(e.halls),!1);return E[u].tables=d,{constructor:e.constructor,halls:E};case T.SELECT_TABLE:return{constructor:{mode:e.constructor.mode,constructorParameters:t.constructorParameters,places:t.places,hallId:t.hallId,tableId:t.tableId},halls:e.halls};case T.CHANGE_CONSTRUCTOR_TYPE:return{constructor:{mode:t.mode,constructorParameters:e.constructor.constructorParameters,places:e.constructor.places,hallId:e.constructor.hallId,tableId:e.constructor.tableId},halls:e.halls};case T.SET_CONSTRUCTOR_PARAMS:return{halls:e.halls,constructor:{mode:e.constructor.mode,constructorParameters:t.params,places:e.constructor.places,hallId:e.constructor.hallId,tableId:e.constructor.tableId}};case T.DELETE_HALL:var p=(0,O.__spreadArray)([],(0,O.__read)(e.halls),!1),_=e.halls.find((function(e){return e.hallId===t.hallId}));return p.splice(e.halls.indexOf(_),1),{constructor:e.constructor,halls:p};case T.ADD_HALL:return{constructor:e.constructor,halls:(0,O.__spreadArray)((0,O.__spreadArray)([],(0,O.__read)(e.halls),!1),[t.hall],!1)};case T.RESET_CONSTRUCTOR:return{constructor:F,halls:e.halls};case T.SAVE_HALL_ID_IN_CONSTRUCTOR:return{constructor:{hallId:t.hallId,mode:e.constructor.mode,constructorParameters:e.constructor.constructorParameters,places:e.constructor.places,tableId:e.constructor.tableId},halls:e.halls};case T.ADD_PLACE_IN_TABLE:return{constructor:{hallId:e.constructor.hallId,constructorParameters:e.constructor.constructorParameters,mode:e.constructor.mode,tableId:e.constructor.tableId,places:(0,O.__spreadArray)((0,O.__spreadArray)([],(0,O.__read)(e.constructor.places),!1),[t.place],!1)},halls:e.halls};case T.DELETE_PLACE_FROM_TABLE:var h=(0,O.__spreadArray)([],(0,O.__read)(e.constructor.places),!1),C=h.find((function(e){return e.placeId===t.placeId}));return h.splice(h.indexOf(C),1),{constructor:{hallId:e.constructor.hallId,constructorParameters:e.constructor.constructorParameters,mode:e.constructor.mode,tableId:e.constructor.tableId,places:h},halls:e.halls};case v.LOAD_HALLS_REQUEST_SUCCESS:return{constructor:e.constructor,halls:t.halls};default:return e}}}),V=n()();V.get(/\.(js|css|map|ico|svg|png|gif|bmp|jpeg|jpg|woff|woff2)$/,n().static(o().resolve(__dirname,"../dist"))),V.use("*",(function(e,t){var a=c().readFileSync(o().resolve("./dist/index.html"),{encoding:"utf8"}),r=((0,p.legacy_createStore)(j),d().renderToString(u().createElement(E.StaticRouter,{location:e.url},u().createElement(G,null))));return a=a.replace('<div class="app"></div>','<div class="app">'.concat(r,"</div>")),t.contentType("text/html"),t.status(200),t.send(a)})),V.listen("9000",(function(){console.log("Express server started at <http://localhost:9000>")}))}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var l=t[r]={exports:{}};return e[r](l,l.exports,a),l.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a(462)})();